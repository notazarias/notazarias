{"cells":[{"cell_type":"markdown","id":"e5d3fca3","metadata":{"id":"e5d3fca3","notebookgrader":{"id":"c4fcf24ce652d95dfc53d189a88877c1bb312bcb","readonly":true}},"source":["# Generators\n","### Copyright Luca de Alfaro, 2020.  License: CC-BY-NC."]},{"cell_type":"markdown","id":"fbf4c1f5","metadata":{"id":"fbf4c1f5","notebookgrader":{"id":"f730e5bd5f015da526076a79ef32b5d0c6e1afdd","readonly":true}},"source":["To understand what a generator is, let's start with a simple example.  \n","Assume we have a long list `words` of words, perhaps obtained by splitting a long document into the individual words.  The words in `words` can be either in uppercase, or in lowercase, or capitalized: we have no guarantees.\n","\n","Our task is this: given an additional word `keyword`, we want to check whether `keyword` appears in the document, regardless of case.\n","\n","One brute force way of doing this consists in creating a lowercase version of `words`, and check if `keyword`, once also put in lowercase, belongs to the list:"]},{"cell_type":"code","execution_count":1,"id":"5b3f9e99","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"5b3f9e99","notebookgrader":{"id":"c25cf6cfb806a4d022403a92d1bae20f08009eec","is_solution":false,"is_tests":false,"readonly":true},"outputId":"2f72c2d6-f165-432d-9deb-5ba8316edc71","executionInfo":{"status":"ok","timestamp":1733463203280,"user_tz":480,"elapsed":270,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["True\n"]}],"source":["words = \"I told you I do not need a PHONE I need a TOASTER\".split()\n","\n","def lowercase_list(words):\n","    \"\"\"Returns the lowercase version of the list\"\"\"\n","    return [w.lower() for w in words]\n","\n","def check_occurrence(words, keyword):\n","    return keyword.lower() in lowercase_list(words)\n","\n","print(check_occurrence(words, \"Phone\"))"]},{"cell_type":"markdown","id":"f01e675d","metadata":{"id":"f01e675d","notebookgrader":{"id":"bc20bb9e2470ace6ea92928ff532b83d937b8d61","readonly":true}},"source":["The problem with this approach is that we are building a whole new duplicate list, just for the purpose of checking membership.\n","\n","One way of avoiding building the whole list is to inter-mingle the generation of the list and its use:"]},{"cell_type":"code","execution_count":2,"id":"d477557a","metadata":{"id":"d477557a","notebookgrader":{"id":"1035fe1035e5bdcca1a4637e4fa58fd3f3f78704","is_solution":false,"is_tests":false,"readonly":true},"executionInfo":{"status":"ok","timestamp":1733463203791,"user_tz":480,"elapsed":209,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[],"source":["def check_occurrence(words, keyword):\n","    for w in words:\n","        if keyword == w.lower():\n","            return True\n","        return False"]},{"cell_type":"markdown","id":"59fba279","metadata":{"id":"59fba279","notebookgrader":{"id":"36684bfd9e7449109912ab234fe1a5aa032e32e2","readonly":true}},"source":["The problem with this is that it mixes the `for` loop in `check_occurrence` with the list transformation.\n","In this case, the list transformation is simple (it consists in a single call to `.lower()`), but if it were complex, it would be a much cleaner design to transform the list in a separate function.\n","\n","Can we have a separate function, similar to `lowercase_list`, that avoids building a full list?\n"]},{"cell_type":"markdown","id":"32717920","metadata":{"id":"32717920","notebookgrader":{"id":"cd33e6fd0fce9dfdf265c0271bc2c4ec6e4ada13","readonly":true}},"source":["It turns out, yes.  Consider this function, which iterates over a list of words, and prints the lowercase version of each word:"]},{"cell_type":"code","execution_count":3,"id":"be68a84c","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"be68a84c","notebookgrader":{"id":"40e7c4eab4676f64bbd1e7e67900d7c4aff50a00","is_solution":false,"is_tests":false,"readonly":true},"outputId":"58b74848-0ecf-476b-a84e-7d8a1d6d7507","executionInfo":{"status":"ok","timestamp":1733463203792,"user_tz":480,"elapsed":8,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["i\n","told\n","you\n","i\n","do\n","not\n","need\n","a\n","phone\n","i\n","need\n","a\n","toaster\n"]}],"source":["def print_lowercase(words):\n","    for w in words:\n","        print(w.lower())\n","\n","print_lowercase(words)"]},{"cell_type":"markdown","id":"0baed37a","metadata":{"id":"0baed37a","notebookgrader":{"id":"91419e65237efe4b2a1166ad0ac3952b96009035","readonly":true}},"source":["The function converts each word to lowercase on the fly, and prints it, without ever building the list of all lowercase words.  Can we just, instead of printing the word, return it?  Then we could check membership without building a new list.  Does this work?"]},{"cell_type":"code","execution_count":4,"id":"c1c8ea8c","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"c1c8ea8c","notebookgrader":{"id":"435c7154b6ad85c41f8d0ad0d09d52d321fcd137","is_solution":false,"is_tests":false,"readonly":true},"outputId":"fe118f5c-921f-4b0c-882d-7b18b26854c9","executionInfo":{"status":"ok","timestamp":1733463203792,"user_tz":480,"elapsed":7,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["False\n"]}],"source":["def return_lowercase(words):\n","    for w in words:\n","        return w.lower()\n","\n","def check_occurrence(words, keyword):\n","    return keyword.lower() in return_lowercase(words)\n","\n","print(check_occurrence(words, \"Phone\"))"]},{"cell_type":"markdown","id":"643e7409","metadata":{"id":"643e7409","notebookgrader":{"id":"c8411cd894bb21d0b67164ff3464b7c9ea5643e5","readonly":true}},"source":["What goes wrong?  The problem is that the `return` statement in line 3 above terminates the execution of the `for` loop.  So `return_lowercase` returns the first word `\"i\"` and terminates.  The check in line 6 then checks whether `\"phone\"` is a member of the list of characters `\"i\"`: if a string is used when a list is expected, the list of characters is used.\n","This is not true, and the check returns `False`.\n","\n","Fundamentally, what goes wrong is that `return` does not allow us to return the lowercase words one by one, because it stops at the first word.  \n","We need a version of `return` that gives the result back, but \"keeps going\" in the loop.  This version of `return` is called `yield`.  Let's try it."]},{"cell_type":"code","execution_count":5,"id":"1301290d","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"1301290d","notebookgrader":{"id":"57f332b54192471b7063d7e74f054cc50fdda320","is_solution":false,"is_tests":false,"readonly":true},"outputId":"ad82f1d7-70c1-4af3-e84a-6c6e707eb502","executionInfo":{"status":"ok","timestamp":1733463203792,"user_tz":480,"elapsed":7,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["True\n"]}],"source":["def yield_lowercase(words):\n","    for w in words:\n","        yield w.lower()\n","\n","def check_occurrence(words, keyword):\n","    return keyword.lower() in yield_lowercase(words)\n","\n","print(check_occurrence(words, \"Phone\"))"]},{"cell_type":"markdown","id":"1a05b16f","metadata":{"id":"1a05b16f","notebookgrader":{"id":"13d2dec9cda8c3c86e5f514184a4e04a47002286","readonly":true}},"source":["This works!\n","\n","And the function `yield_lowercase` is called a generator, because it generates a list -- without ever having to store one.\n","\n","The implementation of the `yield` statement is sophisticated, because it needs essentially to pause execution to return the value, keeping track of the place inside the function, so that execution can be restarted when the next value is needed.  But to understand how to use it, think of `yield` as a version of `print` that, instead of printing, returns the value, and then just like `print`, keeps going."]},{"cell_type":"code","execution_count":6,"id":"6a2fc5ee","metadata":{"id":"6a2fc5ee","notebookgrader":{"id":"cf9271ee5b5b0deb6959feaa67fe599ec4fedb1b","is_solution":false,"is_tests":false,"readonly":true},"executionInfo":{"status":"ok","timestamp":1733463203792,"user_tz":480,"elapsed":6,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[],"source":["#@title Let's define a test helper.\n","\n","def check_equal(x, y, msg=None):\n","    if x != y:\n","        if msg is None:\n","            print(\"Error:\")\n","        else:\n","            print(\"Error in\", msg, \":\")\n","        print(\"    Your answer was:\", x)\n","        print(\"    Correct answer: \", y)\n","    assert x == y, \"%r and %r are different\" % (x, y)"]},{"cell_type":"markdown","id":"0fee4429","metadata":{"id":"0fee4429","notebookgrader":{"id":"9a984cb7050901c1c1e364dcf8e6b66356729b9d","readonly":true}},"source":["## Generators Are Infinitely Useful"]},{"cell_type":"markdown","id":"3f9ec021","metadata":{"id":"3f9ec021","notebookgrader":{"id":"39088f0c9c6ace5e8a51ad462c08f568b4abddef","readonly":true}},"source":["So what can generators do?\n","\n","One thing, as we discovered, is return a variant of a list without every fully building the variant as a list.  This is important, because often we have big data structures in memory, and we want to be able to operate on them without having to duplicate them when we need something else.\n","\n","The most interesting use of generators, however, is to create on the fly -- without ever storing them -- structures that can be very large."]},{"cell_type":"markdown","id":"86498dee","metadata":{"id":"86498dee","notebookgrader":{"id":"4411bbcfb7c3d3a38c39b8d84ae599958a84b0f8","readonly":true}},"source":["In particular, one of the fun facts about generators is that they provide a _finite_ representation for _infinite_ things.  Here is an iterator on even numbers:"]},{"cell_type":"code","execution_count":7,"id":"e6e3f711","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"e6e3f711","notebookgrader":{"id":"59660433745069b7caa6a9f1ea17adfca91e83cb","is_solution":false,"is_tests":false,"readonly":true},"outputId":"5f979022-2ad6-4030-ddff-1d733035a375","executionInfo":{"status":"ok","timestamp":1733463203792,"user_tz":480,"elapsed":6,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["This is even: 0\n","This is even: 2\n","This is even: 4\n","This is even: 6\n","This is even: 8\n"]}],"source":["def even_numbers():\n","    i = 0\n","    while True:\n","        yield 2 * i\n","        i += 1\n","\n","for n in even_numbers():\n","    print(\"This is even:\", n)\n","    if n > 7:\n","        break"]},{"cell_type":"markdown","id":"7b63c503","metadata":{"id":"7b63c503","notebookgrader":{"id":"8d32edafeab9ddee6e353972956b91184f26226a","readonly":true}},"source":["We stopped at 7, but `even_numbers` would have been quite happy to keep going.\n","\n","Here's an iterator that produces all numbers that are not divisible by 2, 3, or 5.  Note how `yield` does not need to appear directly in a loop: it can appear inside if-then-else statements and anything else."]},{"cell_type":"code","execution_count":8,"id":"8c649a87","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"8c649a87","notebookgrader":{"id":"e324ec4393c2abef47a41c138aad81962cca8ed9","is_solution":false,"is_tests":false,"readonly":true},"outputId":"4010e10a-1ef9-4e5c-b648-317ad28ca542","executionInfo":{"status":"ok","timestamp":1733463203792,"user_tz":480,"elapsed":6,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["1\n","7\n","11\n","13\n","17\n","19\n","23\n"]}],"source":["def not_div_235():\n","    i = 0\n","    while True:\n","        if (i % 2) * (i % 3) * (i % 5) > 0:\n","            yield i\n","        i += 1\n","\n","for n in not_div_235():\n","    print(n)\n","    if n > 20:\n","        break"]},{"cell_type":"markdown","id":"ee649c0a","metadata":{"id":"ee649c0a","notebookgrader":{"id":"2dfa138846e33ca7582de72ce012f506fb0101b8","readonly":true}},"source":["**Exercise:** Build a generator that returns the [Fibonacci numbers](https://en.wikipedia.org/wiki/Fibonacci_number)."]},{"cell_type":"code","execution_count":9,"id":"cafebcd0","metadata":{"executionInfo":{"elapsed":5,"status":"ok","timestamp":1733463203792,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"},"user_tz":480},"id":"cafebcd0","notebookgrader":{"id":"7199435554bd081b32e73435f48a13fb2551729d","is_solution":true,"is_tests":false,"readonly":false}},"outputs":[],"source":["#@title Exercise: implement a Fibonacci number generator\n","\n","def fibonacci_generator():\n","    \"\"\"Generates all Fibonacci numbers.\"\"\"\n","    ### YOUR SOLUTION HERE\n","    fib = 0\n","    seq = 1\n","    while True:\n","        yield fib\n","        fib, seq = seq, fib + seq"]},{"cell_type":"code","execution_count":10,"id":"2d37f1fc","metadata":{"cellView":"form","id":"2d37f1fc","notebookgrader":{"id":"a4cb182626504cd2bc350618955042d6f0479ba6","is_solution":false,"is_tests":true,"points_earned":10,"readonly":true,"test_points":10},"executionInfo":{"status":"ok","timestamp":1733463203792,"user_tz":480,"elapsed":5,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[],"source":["# Tests 10 points: Fibonacci numbers\n","\n","r = []\n","for n in fibonacci_generator():\n","    r.append(n)\n","    if n > 100:\n","        break\n","check_equal(r, [0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144])\n"]},{"cell_type":"markdown","id":"541d167b","metadata":{"id":"541d167b","notebookgrader":{"id":"9c929ee9f595aeed1c927761d203c193f35c3aa9","readonly":true}},"source":["**Exercise:** Build a generator that returns all the prime numbers.  The idea is to loop over all positive integers, test each one to see if it is prime, and if it is, `yield` it."]},{"cell_type":"code","execution_count":11,"id":"6c833323","metadata":{"executionInfo":{"elapsed":5,"status":"ok","timestamp":1733463203792,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"},"user_tz":480},"id":"6c833323","notebookgrader":{"id":"ed03bea18e15895ec715c775c1d98c5a22ab4025","is_solution":true,"is_tests":false,"readonly":false}},"outputs":[],"source":["#@title Exercise: implement a prime number generator\n","\n","# My solution is simple and not particularly optimized,\n","# and it is 12 lines long.\n","\n","def prime_number_generator():\n","    \"\"\"This generator returns all prime numbers.\"\"\"\n","    ### YOUR SOLUTION HERE\n","    num = 2\n","    while True:\n","        isPrime = True\n","        for div in range(2, num):\n","            if num % div == 0:\n","                isPrime = False\n","                break\n","        if isPrime:\n","            yield num\n","        num += 1"]},{"cell_type":"markdown","id":"6ecefdcd","metadata":{"id":"6ecefdcd","notebookgrader":{"id":"cb3228ef3eaac1c882bb2782f0df870e50937aa5","readonly":true}},"source":["Let us use our generator:"]},{"cell_type":"code","execution_count":12,"id":"702aac34","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"702aac34","notebookgrader":{"id":"83fdd35d02966a4445b3f1f928c1a72b75248575","is_solution":false,"is_tests":false,"readonly":true},"outputId":"f78c2d9d-81da-493b-9766-085c4863812e","executionInfo":{"status":"ok","timestamp":1733463203792,"user_tz":480,"elapsed":5,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["2\n","3\n","5\n","7\n","11\n","13\n","17\n","19\n","23\n","29\n"]}],"source":["i = 0\n","for n in prime_number_generator():\n","    print(n)\n","    i += 1\n","    if i == 10:\n","        break"]},{"cell_type":"code","execution_count":13,"id":"23a0417a","metadata":{"cellView":"form","id":"23a0417a","notebookgrader":{"id":"c489e938b3850c8020d1de5093e74de7f582653d","is_solution":false,"is_tests":true,"points_earned":10,"readonly":true,"test_points":10},"executionInfo":{"status":"ok","timestamp":1733463203792,"user_tz":480,"elapsed":4,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[],"source":["# Tests 10 points: `prime_number_generator`\n","\n","\n","\n","for n in prime_number_generator():\n","    if n == 33:\n","        raise Exception()\n","    elif n > 37:\n","        break\n"]},{"cell_type":"markdown","id":"3fae6f7e","metadata":{"id":"3fae6f7e","notebookgrader":{"id":"cbdfeaf49d7a602b9955e9754f1e6aeb8148ae98","readonly":true}},"source":["## Generators That Know When To Stop\n","\n","Sometimes, while running a generator, you realize that there's nothing more that needs to be `yield`-ed.  In that case, you can terminate the execution with a `return`.   Let's write a generator that takes a list of words, and iterates over the words until a given stop-word is reached, or until the end of the list, whichever happens first."]},{"cell_type":"code","execution_count":14,"id":"9df1a990","metadata":{"id":"9df1a990","notebookgrader":{"id":"93fd9b481b4ee8e02017b4f200e04fad6bcb0104","is_solution":false,"is_tests":false,"readonly":true},"executionInfo":{"status":"ok","timestamp":1733463203792,"user_tz":480,"elapsed":4,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[],"source":["def words_until_stop(stop_word, words):\n","    for w in words:\n","        if w == stop_word:\n","            # We stop the iteration.\n","            return\n","        else:\n","            yield w"]},{"cell_type":"markdown","id":"e9dbf12b","metadata":{"id":"e9dbf12b","notebookgrader":{"id":"4c66c1ae7d3c3666524a1f26c7d92eda5ec4c6da","readonly":true}},"source":["Note that the function `words_until_stop` has two ways of terminating.  One is when the stop word is met, and the `return` executed.  The other is when the `for` loop runs to completion."]},{"cell_type":"code","execution_count":15,"id":"475a156e","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"475a156e","notebookgrader":{"id":"8dba1b59bf0ef8f3a718cc958e8aa4fdce04551c","is_solution":false,"is_tests":false,"readonly":true},"outputId":"ae96dc11-9841-4eb6-f211-d7f76b529b87","executionInfo":{"status":"ok","timestamp":1733463203792,"user_tz":480,"elapsed":4,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["I\n","like\n","to\n","eat\n"]}],"source":["words = \"I like to eat pears far more than apples\".split()\n","\n","for w in words_until_stop(\"pears\", words):\n","    print(w)"]},{"cell_type":"markdown","id":"2ef77666","metadata":{"id":"2ef77666","notebookgrader":{"id":"61f52e54e02436d4f9e211f726dda792fc2b5a5f","readonly":true}},"source":["## Iterating Over Permutations\n","\n","Let us now write an iterator that, given a list, returns all the permutations of elements in the list.  The [itertools module](https://docs.python.org/3.7/library/itertools.html) contains such an iterator, but it is rather instructive to write it ourselves.\n","\n","Recall that a permutation is a reordering.  So if you have a list\n","\n","    [1, 2, 3]\n","\n","its six permutations are:\n","\n","    [1, 2, 3]\n","    [1, 3, 2]\n","    [2, 1, 3]\n","    [2, 3, 1]\n","    [3, 1, 2]\n","    [3, 2, 1]\n","\n","To generate all permutations, we decompose the problem.  For a list $l$, let $P(l)$ be its set of permutations.  For a set of lists $C$, and for a single list $s$, denote with\n","\n","$$\n","s +^* C = \\{s + c \\mid c \\in C \\}\n","$$\n","\n","the set obtaining by the concatenation of $s$ with every element of $C$.\n","For elements $x_1, \\ldots, x_n$, we have:\n","\n","$$\n","\\begin{align*}\n","P([x_1, \\ldots, x_n]) = \\{ \\, & [x_1] +^* P([x_2, \\ldots, x_n]),\\\\\n","& [x_2] +^* P([x_1, x_3, \\ldots, x_n]), \\\\\n","& \\cdots \\\\\n","& [x_k] +^* P([x_1, \\ldots, x_{k-1}, x_{k+1}, \\ldots, x_n]),\\\\\n","& \\ldots \\\\\n","& [x_n] +^* P([x_1, \\ldots, x_{n-1}]) \\, \\} \\; .\n","\\end{align*}\n","$$\n","\n","In other words, given a list $l$, we can iterate on it, choosing in turn an element $x$.  We can then compute the permutations of $l$ by concatenating $x$ with the permutations of the list $l'$ that results from removing $x$ from $l$."]},{"cell_type":"code","execution_count":16,"id":"19283d5d","metadata":{"cellView":"both","id":"19283d5d","notebookgrader":{"id":"a7193a771ce01f7db3d7bdd60c43ff0531940a0b","is_solution":false,"is_tests":false,"readonly":true},"executionInfo":{"status":"ok","timestamp":1733463203792,"user_tz":480,"elapsed":3,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[],"source":["def permute(elements):\n","    \"\"\"Yields all the permutations of iterable, one by one.\"\"\"\n","    if len(elements) == 0:\n","        yield []\n","    else:\n","        for i, x in enumerate(elements):\n","            # We separate elements into x, and into remainder, that\n","            # consists of all elements minus x.\n","            remainder = elements[:i] + elements[i+1:]\n","            for p in permute(remainder):\n","                yield [x] + p"]},{"cell_type":"code","execution_count":17,"id":"4ce2b110","metadata":{"cellView":"both","colab":{"base_uri":"https://localhost:8080/"},"id":"4ce2b110","notebookgrader":{"id":"55cf0c8a9f87ac497f48dc7e52bd27a356af36ce","is_solution":false,"is_tests":false,"readonly":true},"outputId":"97a1d671-7deb-4c33-9f26-e924df6fc745","executionInfo":{"status":"ok","timestamp":1733463203792,"user_tz":480,"elapsed":3,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["[1, 2, 3]\n","[1, 3, 2]\n","[2, 1, 3]\n","[2, 3, 1]\n","[3, 1, 2]\n","[3, 2, 1]\n"]}],"source":["l = [1, 2, 3]\n","for ll in permute(l):\n","    print(ll)\n","\n","check_equal(len(list(permute([1, 2, 3, 4]))), 24)"]},{"cell_type":"markdown","id":"e3420b46","metadata":{"id":"e3420b46","notebookgrader":{"id":"aa9d2a3f5bff4afcdf224b2df0e04db60cc1fed4","readonly":true}},"source":["### Iterating Over Combinations\n","\n","Given a list containing distinct elements, assume we want to iterate over all pairs of elements of the list.\n","This is easy to do:"]},{"cell_type":"code","execution_count":18,"id":"4c4d28f1","metadata":{"id":"4c4d28f1","notebookgrader":{"id":"30e2dfc0cad5610ae78f9d42ae92c745b259b152","is_solution":false,"is_tests":false,"readonly":true},"executionInfo":{"status":"ok","timestamp":1733463204013,"user_tz":480,"elapsed":224,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[],"source":["def iterate_pairs(elements):\n","    for i, x in enumerate(elements):\n","        for y in elements[i + 1:]:\n","            yield {x, y}"]},{"cell_type":"code","execution_count":19,"id":"49af836d","metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"49af836d","notebookgrader":{"id":"de89fe37e7f2f78f5ec7f1aae332d901d1ca1fb9","is_solution":false,"is_tests":false,"readonly":true},"outputId":"160b0094-21d8-48bf-d0de-56da648d311a","executionInfo":{"status":"ok","timestamp":1733463204013,"user_tz":480,"elapsed":4,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["{1, 2}\n","{1, 3}\n","{1, 4}\n","{2, 3}\n","{2, 4}\n","{3, 4}\n"]}],"source":["mylist = [1, 2, 3, 4]\n","for p in iterate_pairs(mylist):\n","    print(p)"]},{"cell_type":"markdown","id":"662a2b37","metadata":{"id":"662a2b37","notebookgrader":{"id":"4e7918045880388cce10534885cec51fea652d04","readonly":true}},"source":["What if I asked you to iterate over triples of elements?  \n","You could of course use three nested for loops, instead of just two.\n","But at some point, it becomes easier to write the general solution.\n","\n","Consider a list $L = [x_1, x_2, \\ldots, x_n]$ consisting of all distinct elements, and an integer $k$.\n","Let $C(k, L)$ be the set of subsets of $L$ containing $k$ elements.\n","$C(k, L)$ is also known as the _combinations of $L$ in groups of $k$_.\n","\n","We will write a function `combinations(k, L)` that computes $C(k, L)$.\n","To do so, we will use recursion, and write $C(k, L)$ in terms of $C(k-1, \\ldots)$.\n","That is, to generate the subsets of length $k$, we will rely on a recursive call (a call to $C$ itself) to generate the subsets of length $k-1$.\n","To write the recursion, let $\\cup^*$ be the operator taking the union of a set with each set in a set:\n","\n","$$\n","A \\cup^* B = \\{a \\cup b \\mid b \\in B\\} \\; .\n","$$\n","\n","There are three cases, depending on the relation between the size $k$ of the subset we want, and the number $n = |L|$ of elements in $L$.\n","\n","1. If $k = n$, we can just return a set containing $L$.\n","\n","2. If $k > n$, then obviously $C(k, L) = \\emptyset$, where $\\emptyset$ denotes the empty set, as we cannot obtain a subset bigger than the set itself.\n","\n","3. If $k < n$, to generate the $k$-subsets of a list $L$, you pick each element $x$ of $L$ in turn, you consider the list $L'$ of elements following $x$ in $L$, and you return the union of $x$, and of a $k-1$-subset of $L'$.\n","For those who like the precision of formulas:\n","\n","$$\n","\\begin{align*}\n","C(k, [x_1, \\ldots, x_n]) = \\{ \\, & \\{x_1\\} \\cup^* C(k - 1, [x_2, \\ldots, x_n]),\\\\\n","& \\{x_2\\} \\cup^* C(k-1, [x_3, \\ldots, x_n]), \\\\\n","& \\cdots \\\\\n","& \\{x_i\\} \\cup^* C(k-1, [x_{i+1}, \\ldots, x_n]),\\\\\n","& \\cdots \\\\\n","& \\{x_n\\} \\cup^* C(k-1, \\emptyset) \\, \\} \\; .\n","\\end{align*}\n","$$\n","\n"]},{"cell_type":"markdown","id":"fa027153","metadata":{"id":"fa027153","notebookgrader":{"id":"5671a2e9b857fcd8aa48a6df153c4ebed6597084","readonly":true}},"source":["**Exercise:** Implement a function `combinations(k, elements)` implementing the function $C$ above, that is, returning the set of $k$-elements subsets of `elements`.\n","\n","Hint: the difficulty is not in writing the recursion, but in deciding when NOT to recur, and rather, yield a result or the absence of results."]},{"cell_type":"code","execution_count":20,"id":"12d86ec5","metadata":{"executionInfo":{"elapsed":3,"status":"ok","timestamp":1733463204013,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"},"user_tz":480},"id":"12d86ec5","notebookgrader":{"id":"ff432883bb7324f7ee17a7da52e651d6971b655e","is_solution":true,"is_tests":false,"readonly":false}},"outputs":[],"source":["#@title Exercise: Generating Combinations\n","\n","def combinations(k, elements):\n","    assert isinstance(elements, list)\n","    # This can be done in 9 lines of code, and possibly fewer.\n","    ### YOUR SOLUTION HERE\n","    if k == 0:\n","        yield set()\n","    elif k > len(elements):\n","        return\n","    # if k > len(elements):\n","    #     yield set()\n","    elif len(elements) == k:\n","        yield set(elements)\n","    elif len(elements) > k:\n","        for num, x in enumerate(elements):\n","            remainder = elements[num+1:]\n","            for c in combinations(k-1, remainder):\n","                yield set([x]) | c"]},{"cell_type":"code","execution_count":21,"id":"3ccb630a","metadata":{"cellView":"form","id":"3ccb630a","notebookgrader":{"id":"d0b180a3f46a0deb2c77280e45436dc70ea8f294","is_solution":false,"is_tests":true,"points_earned":5,"readonly":true,"test_points":5},"executionInfo":{"status":"ok","timestamp":1733463204013,"user_tz":480,"elapsed":3,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[],"source":["# Tests 5 points: Basic tests for Combination Generation\n","\n","# Let us start from some base cases.\n","L = [1, 2, 3, 4, 5]\n","\n","# There are no combinations of 5 elements in groups of 6.\n","n = 0\n","for c in combinations(6, L):\n","    n += 1\n","check_equal(n, 0)\n","\n","\n","# There is only one combination of 5 elements in groups of 5: the set itself.\n","n = 0\n","for c in combinations(5, L):\n","    check_equal(c, set(L))\n","    n += 1\n","check_equal(n, 1)\n"]},{"cell_type":"code","execution_count":22,"id":"eff4cc76","metadata":{"cellView":"form","id":"eff4cc76","notebookgrader":{"id":"d05298867adb15b4f9bc65cf06a60b371858432f","is_solution":false,"is_tests":true,"points_earned":5,"readonly":true,"test_points":5},"executionInfo":{"status":"ok","timestamp":1733463204013,"user_tz":480,"elapsed":3,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[],"source":["# Tests 5 points: Basic tests 2 for Combination Generation\n","L = [1, 2, 3, 4, 5]\n","\n","# There is only one combination of 5 elements in groups of 0: the empty set.\n","n = 0\n","for c in combinations(0, L):\n","    check_equal(c, set())\n","    n += 1\n","check_equal(n, 1)\n"]},{"cell_type":"code","execution_count":23,"id":"f41324af","metadata":{"cellView":"form","id":"f41324af","notebookgrader":{"id":"5dd9fea5b20fb0c77779ba20590a867fd89c612c","is_solution":false,"is_tests":true,"points_earned":5,"readonly":true,"test_points":5},"executionInfo":{"status":"ok","timestamp":1733463204013,"user_tz":480,"elapsed":3,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[],"source":["# Tests 5 points: Basic tests 3 for Combination Generation\n","L = [1, 2, 3, 4, 5]\n","\n","# There is only one combination of 5 elements in groups of 5: the set itself.\n","n = 0\n","for c in combinations(5, L):\n","    check_equal(c, set(L))\n","    n += 1\n","check_equal(n, 1)\n"]},{"cell_type":"code","execution_count":24,"id":"18c644e0","metadata":{"cellView":"form","id":"18c644e0","notebookgrader":{"id":"d528d3278ece8bc2db575e26cd9a7e39abaa400a","is_solution":false,"is_tests":true,"points_earned":10,"readonly":true,"test_points":10},"executionInfo":{"status":"ok","timestamp":1733463204013,"user_tz":480,"elapsed":3,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[],"source":["# Tests 10 points: Normal tests for Combination Generator\n","\n","L = [1, 3, 4, 2, 5]\n","c2 = combinations(2, L)\n","c3 = combinations(3, L)\n","n = 0\n","ok = False\n","for c in c2:\n","    n += 1\n","    check_equal(len(c), 2)\n","    if c == {3, 2}:\n","        ok = True\n","check_equal(n, 10, msg=\"n\")\n","check_equal(ok, True, msg=\"ok\")\n","\n","n = 0\n","ok = False\n","for c in c3:\n","    check_equal(len(c), 3)\n","    n += 1\n","    if c == {2, 3, 5}:\n","        ok = True\n","check_equal(n, 10)\n","check_equal(ok, True)\n"]},{"cell_type":"markdown","id":"32e2f336","metadata":{"id":"32e2f336","notebookgrader":{"id":"6bd8040ad73e6ea83a78b496097e76c3ed70de32","readonly":true}},"source":["### Iterating Over Subsets\n","\n","Given a set, write an iterator that returns all subsets of the set.  \n","\n","Hint: decompose the problem.  Given a set $S$, let $x \\in S$ and $S' = S \\setminus \\{x\\}$.  Denoting with $P(S)$ (the _powerset_ of $S$) the set of subsets of $S$, we have:\n","\n","$$\n","P(S) = P(S') \\cup \\{T \\cup \\{x\\} \\mid T \\in P(S') \\} \\; .\n","$$\n","\n","In words, if you select an element of $x$, and let $S' = S \\setminus \\{x\\}$, then the subsets of $S$ are the union of:\n","\n","* the subsets of $S'$,\n","* the subsets of $S'$, with $x$ added to them.\n","\n","This enables you to reduce the problem of computing the subsets of $S$, to that of computing the subsets of the smaller set $S'$."]},{"cell_type":"code","execution_count":25,"id":"89f2d60b","metadata":{"executionInfo":{"elapsed":3,"status":"ok","timestamp":1733463204013,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"},"user_tz":480},"id":"89f2d60b","notebookgrader":{"id":"8d1118f6ce3e0a47f4eb89875d51714b963360a5","is_solution":true,"is_tests":false,"readonly":false}},"outputs":[],"source":["#@title Exercise: implement the `subsets` function for sets\n","\n","def subsets(s):\n","    \"\"\"Given a set s, yield all the subsets of s,\n","    including s itself and the empty set.\"\"\"\n","    ### YOUR SOLUTION HERE\n","    # if len(s) == 0:\n","    #     yield set()\n","    #     return\n","\n","    # elements = list(s)\n","    # n = len(elements)\n","\n","    # # go thorugh all of i in the ragne\n","    # for i in range(2**n):\n","    #     subset = set()\n","    s = list(s)\n","    result = [[]]\n","\n","    for element in s:\n","        new_subsets = []\n","        for subset in result:\n","            new_subsets.append(subset + [element])\n","        result.extend(new_subsets)\n","    for subset in result:\n","        yield set(subset)\n","\n","def print_subsets(subsets):\n","    for subset in subsets:\n","        if len(subset) == 0:\n","            print(\"set()\")\n","\n","\n","        #iterates through s"]},{"cell_type":"code","execution_count":26,"id":"cd93c9d1","metadata":{"cellView":"form","colab":{"base_uri":"https://localhost:8080/"},"id":"cd93c9d1","notebookgrader":{"id":"e4ee36c607c3b3ba223467aa67e827148d396e16","is_solution":false,"is_tests":true,"points_earned":10,"readonly":true,"test_points":10},"outputId":"7a65e24b-eaf5-4043-9f48-3f961da56ee6","executionInfo":{"status":"ok","timestamp":1733463204013,"user_tz":480,"elapsed":3,"user":{"displayName":"Azarias Ashenafi","userId":"07661282689053385655"}}},"outputs":[{"output_type":"stream","name":"stdout","text":["set()\n","{1}\n","{2}\n","{1, 2}\n","{3}\n","{1, 3}\n","{2, 3}\n","{1, 2, 3}\n"]}],"source":["# Tests 10 points: `subsets`\n","\n","s = set([1, 2, 3])\n","for t in subsets(s):\n","    print(t)\n","\n","check_equal(len(list(subsets(s))), 8)\n"]}],"metadata":{"colab":{"provenance":[]},"language_info":{"name":"python"},"kernelspec":{"name":"python3","display_name":"Python 3"}},"nbformat":4,"nbformat_minor":5}